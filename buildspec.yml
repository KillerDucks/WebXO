# AWS CodeBuild Build Spec for WebXO
# Author: KillerDucks
# Maintainer: MelissaXO
# Organization: Null

version: 0.2

phases:
    install:
      commands:
        - echo Nothing to do during the install phase
    pre_build:
      commands:
        - echo Running Pre Build phase
        - apt-get update
        - apt-get install -y build-essential cmake zlib1g-dev libgtest-dev
        - echo Running CMake Build Generator
        - RPATH=$(pwd)
        - mkdir ./build
        - cd ./build
        - cmake -G "Unix Makefiles" ../
        - cd ../
        - cd /usr/src/gtest
        - cmake CMakeLists.txt
        - make
        - cp *.a /usr/lib
        - ls -la /usr/lib
        # Put the runner back into the root folder
        - cd $RPATH
        - echo Pre Build phase completed
    build:
      commands:
        - cmake --build ./build --config Debug --target all -- -j 6
    post_build:
        commands:
          - echo Build completed on `date`
        